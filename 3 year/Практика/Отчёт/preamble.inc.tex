%%% Работа с русским языком
\usepackage[english,russian]{babel}   %% загружает пакет многоязыковой вёрстки
\usepackage{fontspec}      %% подготавливает загрузку шрифтов Open Type, True Type и др.
\defaultfontfeatures{Ligatures={TeX},Renderer=Basic}  %% свойства шрифтов по умолчанию
\setmainfont[Ligatures={TeX,Historic}]{Times New Roman} %% задаёт основной шрифт документа
\setsansfont{Comic Sans MS}                    %% задаёт шрифт без засечек
\setmonofont{Courier New}
\usepackage{indentfirst}
\frenchspacing

\renewcommand{\epsilon}{\ensuremath{\varepsilon}}
\renewcommand{\phi}{\ensuremath{\varphi}}
\renewcommand{\kappa}{\ensuremath{\varkappa}}
\renewcommand{\le}{\ensuremath{\leqslant}}
\renewcommand{\leq}{\ensuremath{\leqslant}}
\renewcommand{\ge}{\ensuremath{\geqslant}}
\renewcommand{\geq}{\ensuremath{\geqslant}}
\renewcommand{\emptyset}{\varnothing}

%%% Дополнительная работа с математикой
\usepackage{amsmath,amsfonts,amssymb,amsthm,mathtools} % AMS
\usepackage{icomma} % "Умная" запятая: $0,2$ --- число, $0, 2$ --- перечисление

%% Номера формул
%\mathtoolsset{showonlyrefs=true} % Показывать номера только у тех формул, на которые есть \eqref{} в тексте.
%\usepackage{leqno} % Нумерация формул слева

%% Свои команды
\DeclareMathOperator{\sgn}{\mathop{sgn}}

%% Перенос знаков в формулах (по Львовскому)
\newcommand*{\hm}[1]{#1\nobreak\discretionary{}
{\hbox{$\mathsurround=0pt #1$}}{}}

%%%


%%% Работа с картинками
\usepackage{graphicx}  % Для вставки рисунков
\graphicspath{{images/}{images2/}}  % папки с картинками
\setlength\fboxsep{3pt} % Отступ рамки \fbox{} от рисунка
\setlength\fboxrule{1pt} % Толщина линий рамки \fbox{}
\usepackage{wrapfig} % Обтекание рисунков текстом

%%% Работа с таблицами
\usepackage{array,tabularx,tabulary,booktabs} % Дополнительная работа с таблицами
\usepackage{longtable}  % Длинные таблицы
\usepackage{multirow} % Слияние строк в таблице

%%% Программирование
\usepackage{etoolbox} % логические операторы


%%% Страница
\usepackage{extsizes} % Возможность сделать 14-й шрифт
\usepackage{geometry} % Простой способ задавать поля
	\geometry{
		a4paper,
		total={170mm,257mm},
		top=20mm,
		bottom=20mm,
		left=30mm,
		right=15mm,
	}
 %
%\usepackage{fancyhdr} % Колонтитулы
% 	\pagestyle{fancy}
 	%\renewcommand{\headrulewidth}{0pt}  % Толщина линейки, отчеркивающей верхний колонтитул
% 	\lfoot{Нижний левый}
% 	\rfoot{Нижний правый}
% 	\rhead{Верхний правый}
% 	\chead{Верхний в центре}
% 	\lhead{Верхний левый}
%	\cfoot{Нижний в центре} % По умолчанию здесь номер страницы

\usepackage{setspace} % Интерлиньяж
\onehalfspacing % Интерлиньяж 1.5
%\doublespacing % Интерлиньяж 2
%\singlespacing % Интерлиньяж 1

\usepackage{lastpage} % Узнать, сколько всего страниц в документе.

%
\usepackage{soul}

\usepackage[normalem]{ulem}

%\usepackage{hyperref}
\usepackage[usenames,dvipsnames,svgnames,table,rgb]{xcolor}
\usepackage{pdfpages}
\usepackage{csquotes} % Еще инструменты для ссылок

\usepackage[style=gost-numeric,maxcitenames=2,backend=biber,sorting=nty]{biblatex}

\usepackage{multicol} % Несколько колонок

\usepackage{tikz} % Работа с графикой
\usepackage{pgfplots}
\usepackage{pgfplotstable}

%\author{\LaTeX{} в Вышке}
%\title{5.2.2. Русский язык в \LaTeX: Xe\LaTeX}
%\date{\today}


% свои команды

\newcommand{\imgh}[3]
{
	\begin{figure}[h]
		\center{\includegraphics[width=#1]{#2}}
		\caption{#3}
		\label{ris:#2}
	\end{figure}
}

\usepackage{soul}

\newcommand{\rulefill}[1]
{
	\uline{#1 \hfill}
}

% 8 Листинги

\usepackage{listings}

% Значения по умолчанию
\lstset{
	basicstyle= \footnotesize,
	breakatwhitespace=true,% разрыв строк только на whitespacce
	breaklines=true,       % переносить длинные строки
	%   captionpos=b,          % подписи снизу -- вроде не надо
	% inputencoding=utf-8,
	numbers=left,          % нумерация слева
	numberstyle=\footnotesize,
	showspaces=false,      % показывать пробелы подчеркиваниями -- идиотизм 70-х годов
	showstringspaces=false,
	showtabs=false,        % и табы тоже
	stepnumber=1,
	tabsize=4,              % кому нужны табы по 8 символов?
	frame=single,
	title=\lstname
}

% Стиль для псевдокода: строчки обычно короткие, поэтому размер шрифта побольше
\lstdefinestyle{pseudocode}{
	basicstyle=\small,
	keywordstyle=\color{black}\bfseries\underbar,
	language=Pseudocode,
	numberstyle=\footnotesize,
	commentstyle=\footnotesize\it
}

% Стиль для обычного кода: маленький шрифт
\lstdefinestyle{realcode}{
	basicstyle=\scriptsize,
	numberstyle=\footnotesize
}

% Стиль для коротких кусков обычного кода: средний шрифт
\lstdefinestyle{simplecode}{
	basicstyle=\footnotesize,
	numberstyle=\footnotesize
}

% Стиль для BNF
\lstdefinestyle{grammar}{
	basicstyle=\footnotesize,
	numberstyle=\footnotesize,
	stringstyle=\bfseries\ttfamily,
	language=BNF
}

% Определим свой язык для написания псевдокодов на основе Python
\lstdefinelanguage[]{Pseudocode}[]{Python}{
	morekeywords={each,empty,wait,do},% ключевые слова добавлять сюда
	morecomment=[s]{\{}{\}},% комменты {а-ля Pascal} смотрятся нагляднее
	literate=% а сюда добавлять операторы, которые хотите отображать как мат. символы
	{->}{\ensuremath{$\rightarrow$}~}2%
	{<-}{\ensuremath{$\leftarrow$}~}2%
	{:=}{\ensuremath{$\leftarrow$}~}2%
	{<--}{\ensuremath{$\Longleftarrow$}~}2%
}[keywords,comments]

% Свой язык для задания грамматик в BNF
\lstdefinelanguage[]{BNF}[]{}{
	morekeywords={},
	morecomment=[s]{@}{@},
	morestring=[b]",%
	literate=%
	{->}{\ensuremath{$\rightarrow$}~}2%
	{*}{\ensuremath{$^*$}~}2%
	{+}{\ensuremath{$^+$}~}2%
	{|}{\ensuremath{$|$}~}2%
}[keywords,comments,strings]

% Подписи к листингам на русском языке.
\renewcommand\lstlistingname{Листинг}
\renewcommand\lstlistlistingname{Листинги}
